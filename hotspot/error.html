<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="expires" content="-1">
    <title>Internet hotspot - Error</title>
    <link rel="stylesheet" href="css/style.css">
    <script>
        // Get organization ID from URL parameter or set a default
        function getOrgId() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('org') || 'cmfc3c2fa0001kwyk82la4cw7';
        }

        function getApiUrl() {
            return 'https://ispinnacle.co.ke';
        }

        async function fetchOrganizationDetails() {
            const orgId = getOrgId();
            const apiUrl = `${getApiUrl()}/api/hotspot/organizations/${orgId}`;
            try {
                const res = await fetch(apiUrl, { headers: { 'Accept': 'application/json', 'Cache-Control': 'no-cache' } });
                if (!res.ok) return;
                const data = await res.json();
                if (data && data.organization) updateOrganizationBranding(data.organization);
            } catch (e) { /* ignore */ }
        }

        function updateOrganizationBranding(org) {
            if (org.name) document.title = `${org.name} - Error`;
            const headerLogo = document.querySelector('.header .header-logo');
            if (headerLogo) {
                let html = '';
                if (org.business && org.business.logo) {
                    html += `<img src="${org.business.logo}" alt="${org.name}" class="skeleton rounded" onload="this.classList.remove('skeleton')">`;
                }
                html += `<div class="org-name">${org.name || 'ISPinnacle Hotspot'}</div>`;
                headerLogo.innerHTML = html;
            }
        }

        function toggleTheme() {
            document.documentElement.classList.toggle('dark');
            const isDark = document.documentElement.classList.contains('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            const icon = document.getElementById('theme-icon');
            if (icon) icon.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
        }

        window.onload = function() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            }
            const icon = document.getElementById('theme-icon');
            if (icon) icon.textContent = document.documentElement.classList.contains('dark') ? '‚òÄÔ∏è' : 'üåô';
            fetchOrganizationDetails();
        };
    </script>
</head>

<body>
    <header class="header">
        <div class="header-logo">
            <div class="org-name">ISPinnacle Hotspot</div>
        </div>
        <button class="theme-toggle" onclick="toggleTheme()"><span id="theme-icon">üåô</span></button>
    </header>
    <div class="ie-fixMinHeight">
        <div class="main">
            <div class="wrap">
                <h1>Hotspot error: $(error)</h1>
                <p class="info">Log in page: <a href="$(link-login)">$(link-login)</a></p>
            </div>
        </div>
    </div>
</body>

</html>
